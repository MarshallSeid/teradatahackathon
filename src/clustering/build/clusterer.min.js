/*

 Copyright 2013 Google Inc. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function m(a){return function(){return this[a]}}var n;function q(a){this.c=a;this.a=new s;this.b=new t(a)}n=q.prototype;n.o=function(a){this.b=a};n.n=function(a){var b=this.a.getItems();this.a=a;this.a.addItems(b)};n.h=function(a){this.a.addItem(a)};n.i=function(a){this.a.addItems(a)};n.j=function(){this.a.clearItems()};n.k=function(a){this.a.removeItem(a)};n.l=function(){var a=this.a.getClusters(this.c.getZoom());this.b.onClustersChanged(a)};n.m=function(){};function u(a,b){this.a=a;this.c=b}
u.prototype.getPosition=m("a");u.prototype.b=m("c");function v(a,b){this.b=a;this.a=b;this.c=this.a.length}v.prototype.getPosition=m("b");v.prototype.getItems=m("a");v.prototype.getSize=m("c");function t(a){this.b=a;this.a=[]}
t.prototype.onClustersChanged=function(a){for(var b=0;b<a.length;b++){var c;b<this.a.length?(c=this.a[b],c.getMap()||c.setMap(this.b)):(c=new google.maps.Marker({map:this.b}),this.a[b]=c);c.setPosition(a[b].getPosition());var d=a[b].getSize()/30,d=Math.min(1,Math.sqrt(d)),d=Math.min(Math.round(255*d),255);c.setIcon({path:google.maps.SymbolPath.CIRCLE,scale:10,strokeWeight:4,fillColor:"rgb("+d+",0,0)",fillOpacity:1})}for(;b<this.a.length;b++)this.a[b].getMap()&&this.a[b].setMap(null)};
function w(a){this.b=this.a=null;this.c=a}function x(a){a=a||[];for(var b=[],c=[],d=0;d<a.length;d++)b[d]=a[d],c[d]=a[d];b.sort(z);c.sort(A);this.a=B(b,c,!0)}function z(a,b){if(a.x<b.x)return-1;if(a.x===b.x){if(a.y<b.y)return-1;if(a.y===b.y){if(a.index<b.index)return-1;if(a.index===b.index)return 0}}return 1}function C(a,b){return a.x<b.x||a.x===b.x&&(a.y<b.y||a.y===b.y&&a.index<b.index)}
function A(a,b){if(a.y<b.y)return-1;if(a.y===b.y){if(a.x<b.x)return-1;if(a.x===b.x){if(a.index<b.index)return-1;if(a.index===b.index)return 0}}return 1}function D(a,b){return a.y<b.y||a.y===b.y&&(a.x<b.x||a.x===b.x&&a.index<b.index)}
function B(a,b,c){var d;if(1===a.length)return d=new w(a[0]);if(0===a.length)return null;var k=a.length/2|0,e=a[k];d=new w(e);for(var g=[],l=[],f=0;f<k;f++)g[f]=a[f];f++;for(k=0;f<a.length;f++)l[k++]=a[f];a=[];for(var h=[],r=k=0,f=0;f<b.length;f++){var p=b[f];p!==e&&(c?C(p,e)?a[k++]=p:h[r++]=p:D(p,e)?a[k++]=p:h[r++]=p)}d.a=B(a,g,!c);d.b=B(h,l,!c);return d}
function E(a,b,c){if(null===a)return null;if(b===c)return a.a?E(a.a,b,!c):a.c;var d=E(a.a,b,!c);c=E(a.b,b,!c);a=a.c;b?(d&&C(d,a)&&(a=d),c&&C(c,a)&&(a=c)):(d&&D(d,a)&&(a=d),c&&D(c,a)&&(a=c));return a}function F(a,b,c){if(null===a)return null;if(b===c)return a.b?F(a.b,b,!c):a.c;var d=F(a.a,b,!c);c=F(a.b,b,!c);a=a.c;b?(d&&!C(d,a)&&(a=d),c&&!C(c,a)&&(a=c)):(d&&!D(d,a)&&(a=d),c&&!D(c,a)&&(a=c));return a}
function G(a,b,c){if(null!==b)if(b.c===a)if(null!==b.b)b.c=E(b.b,c,!c),b.b=G(b.c,b.b,!c);else if(null!==b.a)b.c=F(b.a,c,!c),b.a=G(b.c,b.a,!c);else return b.c=null;else(c?C(a,b.c):D(a,b.c))?b.a=G(a,b.a,!c):b.b=G(a,b.b,!c);return b}
function H(a,b,c,d){if(null===b)return d;var k=b.c,e=a.x-k.x,g=a.y-k.y,e=e*e,g=g*g;if(a!==k){var l=e+g;l<d.distance&&(d.distance=l,d.e=k)}c?k=a.x<k.x:(k=a.y<k.y,e=g);k?(d=H(a,b.a,!c,d),b.b&&e<=d.distance&&(d=H(a,b.b,!c,d))):(d=H(a,b.b,!c,d),b.a&&e<=d.distance&&(d=H(a,b.a,!c,d)));return d}function I(a){this.b=a||[];this.a=this.b.length;if(a)for(a=Math.floor((this.a-1-1)/2);0<=a;a--)J(this,a)}
function J(a,b){for(var c=a.b,d=b,k=c[b],e=k.value,g=k;;){var l=2*b+1;if(l<a.a){var f=c[l];f.value<e&&(d=l,g=f);l+=1;l<a.a&&(f=c[l],f.value<g.value&&(d=l,g=f));if(d!==b)c[b]=g,b=d;else{c[b]=k;break}}else{c[b]=k;break}}}function K(a,b,c,d,k,e){this.x=a;this.f=b;this.y=c;this.g=d;this.d=k;this.valid=!0;this.index=e}function s(a){this.a=[];this.b=0;this.c=null!=a?a:30}n=s.prototype;
n.addItem=function(a){var b=a.getPosition(),c;c=256*(b.lng()/360+0.5);b=b.lat();b=128*(1+-Math.log(Math.tan((0.25+b/360)*Math.PI))/Math.PI);this.a[this.b]={x:c,y:b,item:a};this.b++};n.addItems=function(a){for(var b=0;b<a.length;b++)this.addItem(a[b])};n.clearItems=function(){this.a=[];this.b=0};n.getItems=function(){for(var a=[],b=0;b<this.a.length;b++)a[b]=this.a[b];return a};
n.removeItem=function(a){for(var b=0;b<this.b;b++)if(this.a[b].item===a){this.b--;this.a[b]=this.a[this.b];this.a[this.b]=null;break}};
n.getClusters=function(a){for(var b,c=[],d=0;d<this.b;d++)b=new K(this.a[d].x,this.a[d].x,this.a[d].y,this.a[d].y,[d],c.length),c[d]=b;var k=this.c/(1<<a);b=new x(c);d=[];for(a=0;a<c.length;a++){var e=c[a],g=H(e,b.a,!0,{e:null,distance:Number.MAX_VALUE});d[a]={origin:e,a:g.e,value:g.distance}}d=new I(d);a=c.length;for(k*=k;d.b[0].value<k&&1<a;)if(e=d,g=e.b[0],e.a--,e.b[0]=e.b[e.a],e.b[e.a]=null,J(e,0),e=g,e.origin.valid){var l;if(e.a.valid){var f=e.origin,h=e.a,g=f.d;l=g.length;for(var r=h.d,p=r.length,
y=0;y<p;y++)g[l+y]=r[y];var r=f.f+h.f,p=f.g+h.g,y=r/g.length,L=p/g.length;f.valid=!1;b.a=G(f,b.a,!0);h.valid=!1;b.a=G(h,b.a,!0);l=Math.min(f.index,h.index);f=Math.max(f.index,h.index);a--;c[f]=c[a];c[f].index=f;c[a]=null;g=new K(y,r,L,p,g,l);c[l]=g;h=b;f=g;if(h.a)for(h=h.a,l=!0;;){r=l?C(f,h.c):D(f,h.c);if(f===h.c)throw Error("duplicate entry by our metric");if(r){if(!h.a){h.a=new w(f);break}h=h.a}else{if(!h.b){h.b=new w(f);break}h=h.b}l=!l}else h.a=new w(f)}else g=e.origin;if(2>a)break;e.origin=g;
g=H(g,b.a,!0,{e:null,distance:Number.MAX_VALUE});e.a=g.e;e.value=g.distance;h=d;g=h.b;f=h.a;g[f]=e;h.a++;for(e=Math.floor((f-1)/2);0<=e&&g[f].value<g[e].value;)h=g[e],g[e]=g[f],g[f]=h,f=e,e=Math.floor((f-1)/2)}k=[];for(d=0;d<a;d++){b=c[d];e=b.d;e=1===e.length?this.a[e[0]].item.getPosition():new google.maps.LatLng(360/Math.PI*Math.atan(Math.exp(-(Math.PI*(b.y/128-1))))-90,360*(b.x/256-0.5));g=[];for(f=0;f<b.d.length;f++)g[f]=this.a[b.d[f]].item;k[d]=new v(e,g)}return k};self.DefaultClusterManager=q;q.prototype.setRenderer=q.prototype.o;q.prototype.setAlgorithm=q.prototype.n;q.prototype.addItem=q.prototype.h;q.prototype.addItems=q.prototype.i;q.prototype.clearItems=q.prototype.j;q.prototype.removeItem=q.prototype.k;q.prototype.cluster=q.prototype.l;q.prototype.onCameraChange=q.prototype.m;self.DefaultClusterItem=u;u.prototype.getPosition=u.prototype.getPosition;u.prototype.getMarkerOptions=u.prototype.b;self.DefaultCluster=v;v.prototype.getPosition=v.prototype.getPosition;
v.prototype.getItems=v.prototype.getItems;v.prototype.getSize=v.prototype.getSize;self.DefaultClusterRenderer=t;t.prototype.onClustersChanged=t.prototype.onClustersChanged;self.HierarchicalClusterer=s;s.prototype.addItem=s.prototype.addItem;s.prototype.removeItem=s.prototype.removeItem;s.prototype.getClusters=s.prototype.getClusters;
